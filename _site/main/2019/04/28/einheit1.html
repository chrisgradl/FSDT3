<!DOCTYPE html>
<html lang="en-us">
  
  <head>
  <meta charset="UTF-8">
  <title>ASEN Part 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <link rel="stylesheet" href="/fsdt3/css/normalize.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/fsdt3/css/cayman.css">
</head>


  <body>
    <section class="page-header">
  <h1 class="project-name">ASEN Part 2</h1>
  <h2 class="project-tagline">Angewandte Sensorik und Elektronik</h2>
  <a href="/fsdt3/" class="btn">Home</a>
  <a href="https://github.com/chrisgradl/fsdt3/archive/master.zip" class="btn">Project Files as zip</a>
</section>


    <section class="main-content">
      
      <h1 id="online-session-1-server-side-javascript-with-nodejs">Online Session 1: Server Side Javascript with Node.js</h1>

<h2 id="repetition-nodejs">Repetition node.js</h2>

<h3 id="task-1-hello-world-in-nodejs">TASK 1: Hello World in Node.js</h3>

<p>For our first Node.js application create a new directory with the name: <code class="highlighter-rouge">asen2_task_1</code>. Switch to this directory and create a new index.js file. Write a simple output to the console</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hello World"</span><span class="p">);</span> </code></pre></figure>

<p>On the command line switch to the directory and start your node application.
What is happening?</p>

<h3 id="task-2-hello-world-via-http">TASK 2: Hello World via http</h3>

<p>Often you want to serve or process data over http with a node application. To do so you have to start a http server in your node application.
Create a new directory with the name: <code class="highlighter-rouge">asen2_task_2</code>. Switch to this directory and create a new index.js file.To start a http server you have to load the http module and call the <code class="highlighter-rouge">createServer</code> function.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="c1">//create Server with anonymous function as parameter</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
  <span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span></code></pre></figure>

<p>Start your Node application and open the url: <a href="http://localhost:8080">http://localhost:8080</a> You should see the Hello World String returned in your Browser.</p>

<p>Why does this program not finish?</p>

<h2 id="node-is-using-modules-to-load-additional-components">Node is using Modules to load additional components</h2>

<p>We already used one module from node.js: the http module. Modules are additional components which can be used in Node.js. We have the core modules which are provided by Node.js and additional modules which can be loaded into our application. We can even write our own modules which we then can use. Think of modules as Javascript libraries such as jquery. You can see a full list of the Node core modules in the official <a href="https://nodejs.org/dist/latest-v6.x/docs/api/">documentation</a>. You can load a module with the require function</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">varWhereModuleIsSaved</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'module name as string'</span><span class="p">);</span></code></pre></figure>

<h2 id="nodejs-is-event-based">Node.js is Event Based</h2>

<p>Node is Event Based. This means that you can subscribe to certain events and call a function when the event is fired:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">object</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'eventAsString'</span><span class="p">,</span> <span class="nx">anonfunc</span><span class="p">);</span></code></pre></figure>

<p>We have an object where we want to subscribe to a function. We call the function and have two parameters: A String which tells the object which event we want to subscribe and the function which is called when the action happens. Based on the implementation this function can have several parameters.</p>

<p>We want to rewrite our hello world application to use events</p>

<h3 id="task-3-hello-world-with-events">TASK 3: Hello World with events</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Event: Request was triggered and this function was called"</span><span class="p">);</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">"Hello World"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Event: Listen was triggered"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Server running on port 8080"</span><span class="p">);</span></code></pre></figure>

<ul>
  <li>log an additional event when a connection is established. The event is subscribed by <code class="highlighter-rouge">connection</code>. The Callback function has no arguments.</li>
  <li>Start the server and open the website. In which order do the events get fired?</li>
</ul>

<h2 id="node-is-asynchronous-and-non-blocking">Node is asynchronous and Non Blocking:</h2>

<p>Javascript is single threaded which makes it inherently synchronous. This means Javascript is executed line by line until the application is finished. Since Node is based in Javascript, it inherits this single threaded synchronous behavior. When you have long running blocking operations such as reading or writing files this would block the application until the operation is over. You usually do not want this behavior in a server environment. Node is handling this problem with an event-driven architecture. When a blocking and time intensive operation is started the application does not wait for it to be finished. Instead it sends an event when the process is finished.</p>

<h3 id="task-4-reading-a-file-in-sync-and-async">TASK 4: Reading a file in sync and async</h3>

<p>We will read the input of a file in two different ways to show the difference between synchronous and asynchronous.</p>

<ul>
  <li>Create directory with name <code class="highlighter-rouge">asen2_task_4</code></li>
  <li>Copy a text based file of your choice into this directory</li>
  <li>Create a index.js file with following Code:</li>
</ul>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">contents</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">'DATA'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">contents</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Data was loaded in Sync"</span><span class="p">);</span></code></pre></figure>

<ul>
  <li>Create an event based version</li>
  <li>look at this
<a href="https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_readfile_file_options_callback/">link</a> how to load a file asynchronous</li>
  <li>print out the data from the text file in the callback function</li>
  <li>Compare the two versions and the order of the log.</li>
</ul>

<h2 id="repetition-npm">Repetition npm</h2>

<h3 id="task-5">TASK 5:</h3>
<ul>
  <li>create a new project with npm</li>
  <li>Create a new directory called <code class="highlighter-rouge">asen2_task_5</code></li>
  <li>Switch into the dir on the command line and run <code class="highlighter-rouge">npm install express</code></li>
  <li>What happened inside the asens2_task_5 folder?</li>
</ul>

<h3 id="local-or-global-installation">Local or Global installation</h3>

<p>There are two ways to install npm packages: locally or globally. You choose which kind of installation to use based on how you want to use the package. In the previous task we installed the express module locally. So npm created the folder node_modules with the required express js code. This would allow us to use the express module in our node application.</p>

<p>If you want to depend on the package from your own module using something like Node.js require, then you want to install locally, which is npm install’s default behavior. On the other hand, if you want to use it as a command line tool, something like a utility tool then you want to install it globally.</p>

<h2 id="globally">Globally</h2>

<p>We install a module globally. By adding the <code class="highlighter-rouge">-g</code> flag to the command we tell npm to install it globally. This means the installed library is accessible from the command line like npm or node</p>

<h3 id="task-6">TASK 6:</h3>

<ul>
  <li>run the command <code class="highlighter-rouge">npm install -g bebusy</code></li>
  <li>then start the tool by running <code class="highlighter-rouge">bebusy</code> on the command line</li>
</ul>

<h2 id="repetition-express">Repetition Express</h2>

<p>For our Arduino project we will use the express module. Express is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications. We will use express mainly for serving static files for our web app. It is similar to the http module.</p>

<p>Routing refers to determining how an application responds to a client request to a particular endpoint, which is a URI (or path) and a specific HTTP request method (GET, POST, and so on).
A route has following structure in express</p>

<blockquote>
  <p><code class="highlighter-rouge">app.METHOD(PATH, HANDLER)</code></p>
</blockquote>

<p>where:</p>

<ul>
  <li>app is an instance of express.</li>
  <li>METHOD is an HTTP request method, in lowercase.</li>
  <li>PATH is a path on the server.</li>
  <li>HANDLER is the function executed when the route is matched.</li>
</ul>

<h3 id="task-8-hello-world-with-express-and-static-file">TASK 8: Hello World with Express and static file</h3>

<ul>
  <li>create a new dir called <code class="highlighter-rouge">asen_task_8</code></li>
  <li>switch to the command line and run <code class="highlighter-rouge">npm init</code></li>
  <li>install express as local dependency</li>
  <li>create a index.js file</li>
  <li>create a folder public</li>
  <li>create the file app.html in the public folder with hello world as h1 tag and valid html tags</li>
  <li>open the index.js file and add following code</li>
</ul>

<script src="https://gist.github.com/chrisgradl/1f6bd821a711ec80a46f1802e318f14e.js">
</script>

<ul>
  <li>add a image of a cat to your public folder</li>
  <li>create an additional route with the url /cat which returns the image</li>
  <li>create the dir js in the public folder</li>
  <li>add a client.js file into this folder</li>
  <li>write something to the console in this javascript file</li>
  <li>load the script into your index.html file and check if the output is visible on the console in the browser</li>
</ul>

<p>We have created the basic skeleton for our web app with express.</p>

<h2 id="repetition-socketio">Repetition Socket.io</h2>
<p>Socket.IO enables real-time bidirectional event-based communication. It consists in</p>

<ul>
  <li>a Node.js server</li>
  <li>a Javascript client library for the browser (or a Node.js client)</li>
</ul>

<p>Socket.io uses several technologies to create this real-time connection depending which are available for the clients. For example:</p>

<ul>
  <li>WebSocket</li>
  <li>Flash Socket</li>
  <li>AJAX long-polling</li>
</ul>

<p>Compared to a http request where a client requests data from a server, the socket.io connection also allows to send data from the server to the client.
We will use socket.io to send sensor values from our node application to a website to visualize the data.</p>

<ul>
  <li>The client(the website) will establish a socket.io connection to our node application.</li>
  <li>Every time the sensor values are changing the node application will send a message to the website.</li>
</ul>

<h3 id="task-9-simple-socketio-example">TASK 9: Simple Socket.io example</h3>
<p>We want to develop a simple example with socket.io and express</p>

<ul>
  <li>create a new folder <code class="highlighter-rouge">asen_task_9</code></li>
  <li>switch to the folder on the command line</li>
  <li>run <code class="highlighter-rouge">npm init</code></li>
  <li>run <code class="highlighter-rouge">npm install express --save</code></li>
  <li>run <code class="highlighter-rouge">npm install socket.io --save</code></li>
  <li>create a index.js file</li>
  <li>create the directory <code class="highlighter-rouge">public</code></li>
  <li>create a <code class="highlighter-rouge">app.html</code> file in the public dir</li>
  <li>initialize express and return the app.html file  on the base route</li>
  <li>test if your node app is returning your app.html website on the url</li>
  <li>to use express together with socket.io we have to initialize the express module in a different way since we have to pass the http server module to socket.io:</li>
</ul>

<script src="https://gist.github.com/chrisgradl/b8101e92feb7f998816b2d28fd6f8dd3.js"></script>

<p>we register a listener on the <code class="highlighter-rouge">connection</code> event of the socket object. In the callback we get the associated socket. With this socket object we can communicate with the connected client.</p>

<p>We test our our socket.io server with a simple javascript client on our app.html site.</p>

<ul>
  <li>open the app.html file</li>
  <li>load the socket.io library before <code class="highlighter-rouge">&lt;/body&gt;</code></li>
  <li>since we have the node module on our node server we can load the associated client library directly</li>
</ul>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"http://localhost:3000/socket.io/socket.io.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script&gt;</span></code></pre></figure>

<ul>
  <li>we then can create a socket.io client and connect to the server</li>
</ul>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
  <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'http://localhost:3000'</span><span class="p">);</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="c1">// when we receive a hello message from the server we send back a info message</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'info'</span><span class="p">,</span> <span class="s2">"BLABALAB"</span><span class="p">);</span>
  <span class="p">});</span>
<span class="o">&lt;</span><span class="sr">/script&gt;</span></code></pre></figure>

<ul>
  <li>Open the website in your browser</li>
  <li>control the output on the command line and in your browser.</li>
</ul>

<h2 id="task-10--assignment">TASK 10 / Assignment</h2>

<p>extend Task 9:</p>

<ul>
  <li>send a random number to the website every 10 ms. Use the setInterval Method for it</li>
  <li>make sure to stop the timer when the client disconnects</li>
</ul>

<p>Feedback:</p>

<ul>
  <li>Did you learn something new today?</li>
  <li>Do you want more theoretical input?</li>
  <li>Less Coding more input?</li>
  <li>Slides instead or Blog?</li>
  <li>For the Pros: what do you want to learn?</li>
</ul>

<h2 id="pro-task">Pro Task:</h2>
<p>Every year some students hand in the assignments in the wrong file information. Help them out by writing a custom node.js script which</p>

<ul>
  <li>takes the matrikelnumber and the path to the project folder as arguments</li>
  <li>creates a zip file which contains all files of the folder except the node_modules folder</li>
</ul>


      <footer class="site-footer">
  <span class="site-footer-owner"><a href="">ASEN Part 2</a> is maintained by <a href="https://www.fhstp.ac.at/de/uber-uns/mitarbeiter-innen-a-z/gradl-christian">Christian Gradl</a>.</span>
  <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/pietromenna/jekyll-cayman-theme">Cayman theme</a> by <a href="http://github.com/jasonlong">Jason Long</a>.</span>
</footer>


    </section>

  </body>
</html>
